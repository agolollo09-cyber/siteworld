name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Pages
      uses: actions/configure-pages@v4
      
    - name: Prepare site files
      run: |
        # Crea directory per il sito
        mkdir -p site
        
        # Copia tutti i file HTML
        cp *.html site/ 2>/dev/null || true
        
        # Copia le immagini
        cp *.png site/ 2>/dev/null || true
        cp *.jpg site/ 2>/dev/null || true
        cp *.jpeg site/ 2>/dev/null || true
        cp *.gif site/ 2>/dev/null || true
        cp *.svg site/ 2>/dev/null || true
        
        # Copia CSS e JS se esistono
        cp -r css site/ 2>/dev/null || true
        cp -r js site/ 2>/dev/null || true
        cp -r assets site/ 2>/dev/null || true
        
        # Non copiare la desktop-app (è già nel .gitignore)
        
        # Lista dei file copiati per debug
        echo "Files copied to site directory:"
        find site -type f -name "*" | head -20
      
    - name: Upload Pages artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: site
        
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

# Configura i permessi necessari per Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Consenti solo un deployment concurrent
concurrency:
  group: "pages"
  cancel-in-progress: false